# UTags Advanced Filter

在任意网站对列表型内容进行实时过滤与隐藏的用户脚本。区别于站点自身的搜索/筛选，本脚本在页面内直接隐藏不满足条件的条目，支持即时切换与叠加条件查看过滤后的结果。当前先适配 Greasy Fork 的脚本列表，后续将通过“规则”适配更多站点（如 Discourse 话题列表、话题回复、GitHub Issues 等）。

## 核心能力

- 实时过滤与隐藏：不跳转、不请求服务端，直接在页面内隐藏不满足条件的条目
- 条件可叠加：多个过滤条件可同时启用（更新日期、创建日期、安装量等）
- 顶端状态栏：左侧显示“显示 N | 隐藏 M”，右侧为侧边栏固定开关的 SVG 图标
- 侧边栏固定：支持固定在顶端并独立滚动，交互开关可持久化保存
- 性能优化：对列表项指标进行 `WeakMap` 缓存，减少重复 DOM 解析
- 持久化：使用 `GM_getValue`/`GM_setValue` 保存过滤状态与阈值

## UI 设计（新版）

- 独立界面：使用 `ShadowRoot` 承载过滤 UI，避免被原网站样式影响。
- 现代风格：引入 Tailwind CSS 风格（CDN），简洁一致的控件与布局。
- 固定位置：过滤界面固定在页面右上角显示，始终可见。
- 可折叠：支持折叠为一个悬浮按钮；折叠/展开状态会持久化保存。
- 交互更新：所有筛选项更改即时应用，状态统计实时更新。

## 当前适配：Greasy Fork 脚本列表

- 过滤项
  - 根据更新日期：隐藏最近 X 天未更新的脚本
  - 根据创建日期（以前）：隐藏创建于 X 天以前的脚本
  - 根据创建日期（以内）：隐藏创建于 X 天以内的脚本
  - 安装量过滤：
    - 隐藏总安装量小于 N 的脚本
    - 隐藏日安装量小于 N 的脚本
- 交互特性
  - 每个过滤项可独立开关，条件可叠加
  - 顶部状态栏显示实时统计；图标切换侧栏固定
  - 设置持久化保存，刷新后仍保持

## 安装与使用

- 安装方式
  - 推荐使用 Tampermonkey/Violentmonkey/Greasemonkey 等用户脚本管理器
- 将 `utags-advanced-filters.user.js` 安装到管理器中
- 生效范围
  - 元数据默认匹配 `*://*/*`，但当前仅在 Greasy Fork 的脚本列表页面启用过滤 UI
  - 后续将通过规则扩展到更多站点
- 使用步骤
  - 打开 Greasy Fork 脚本列表或按站点路径进入脚本列表页
  - 侧栏将出现过滤器分组与顶端状态栏，选择/输入条件后立即应用

## 规则适配设计（规划）

- 站点检测
  - 域名/路径匹配，或自定义判定函数
- 列表结构
  - 列表容器选择器、列表项选择器
  - 指标解析器（更新/创建时间、计数等），与通用条件映射
- 行为策略
  - 隐藏/折叠/淡化/标记等行为策略，可按站点配置
- UI 部署
  - 顶栏与过滤项 UI 的挂载位置、排序与布局
- 存储策略
  - 每站点独立命名空间的持久化键，或共享键下的站点分组

## 存储键名

- 过滤器状态：`universal_list_filters`
  - 保存更新/创建/安装量等条件的启用状态与阈值
  - 保存侧边栏固定开关状态
  - 保存筛选界面折叠/展开状态（`uiCollapsed`）

## 性能与限制

- 性能
  - 使用 `WeakMap` 缓存列表项的时间/安装量等解析结果，避免重复计算
  - 最小化 DOM 查询次数和重绘频率
- 限制
  - 列表动态变更（站点脚本实时更新列表内容）时，缓存不会自动刷新；可在后续版本加入 DOM 变更监听与按需失效

## 路线图

- 适配更多站点：Discourse、GitHub Issues/PRs、Reddit/论坛列表等
- 规则系统：抽象统一的站点适配接口，支持外部规则配置/注入
- UI 统一：通用组件与主题；更丰富的行为策略（折叠/淡化）

## 后续功能

- 支持显示/隐藏个别筛选项：每个网站可配置多个筛选项，用户可选择只显示常用项。
- 支持同步设置：在不同设备/浏览器间同步过滤配置，或提供导入/导出与远程存储方案。
- 支持单项隐藏按钮：为列表中的每个项目添加“隐藏”按钮，点击后立即隐藏该项目，并可持久记录与管理已隐藏项。

## License

Copyright (c) 2025 [Pipecraft](https://www.pipecraft.net). Licensed under the [MIT License](LICENSE).

## >\_

[![Pipecraft](https://img.shields.io/badge/site-pipecraft-brightgreen)](https://www.pipecraft.net)
[![UTags](https://img.shields.io/badge/site-UTags-brightgreen)](https://utags.link)
